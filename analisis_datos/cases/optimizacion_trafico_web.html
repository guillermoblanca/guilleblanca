<h2>Extracción de datos Muxunav</h2>

<p>
  Esta función permite utilizar los datos de la tabla ventas generando un datatable con los datos de fecha y hora de compra, tipo de compra, importe y código de autorización
  en caso de que no se haya comprado en Efectivo o sea Venta Perdida.
</p>

<pre>
  <code class="language-python">

    def normalize_product_name(name):
    if pd.isna(name):
        return "Desconocido"

    name = name.lower()
    name = re.sub(r'[^a-z ]','',name) #Solo letras y espacios
    name = re.sub(r'\s+', ' ', name).strip() #Quitamos espacios adicionales
    name = name.capitalize()
    return name

def procesar_ventas(path: str, ubicacion: str, skip_footer: int = 10, header: int = 2) -> pd.DataFrame:
    """
    Procesa un archivo de ventas Excel y devuelve un DataFrame limpio.

    Args:
        path: Ruta del archivo Excel | CSV.
        ubicacion: Nombre de la ubicación de la tienda.
        skip_footer: Número de filas finales a excluir (subtotales u otros datos).
        header: Fila inicial que contiene los nombres de las columnas.

    Returns:
        pd.DataFrame con columnas: producto, importe, tipo, fecha_hora, ubicacion.
    """
    if path.endswith('.csv'):
        df = pd.read_csv(path, header=header)
    elif path.endswith(('xls','xlsx')):
        df = pd.read_excel(path, header=header)
    else:
        raise ValueError("Formato de archivo no soportado")
    
    df = df.drop(columns= ("Unnamed: 0"), errors='ignore')
    
    if skip_footer > 0:
        df = df[:-skip_footer] #Quitamos los ultimos valores de ventas que reflejan el subtotal
    
    df.columns = df.columns.str.strip().str.lower()
     # Manejar fecha y hora
    if 'fecha' in df.columns and 'hora' in df.columns:
        df['fecha'] = pd.to_datetime(df['fecha'], errors='coerce', dayfirst=True)
        df['hora'] = pd.to_timedelta(df['hora'], errors='coerce')
        df['fecha_hora'] = df['fecha'] + df['hora']
    elif 'fechahora' in df.columns:
        df['fecha_hora'] = pd.to_datetime(df['fechahora'], errors='coerce') 
    else:
        raise ValueError("No se encontró columna de fecha/hora en el archivo")

    df = df[['producto','importe','tipo','fecha_hora']]
    df['importe'] =pd.to_numeric(df['importe'].astype(str).str.replace(',','.'), errors='coerce')

    df['producto'] = df['producto'].apply(normalize_product_name)
    df['ubicacion'] = ubicacion
    return df


  </code>
</pre>